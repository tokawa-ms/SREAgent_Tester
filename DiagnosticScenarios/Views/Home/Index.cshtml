@{
    ViewData["Title"] = "ãƒ›ãƒ¼ãƒ ";
}

<div class="row">
    <div class="col-md-12">
        <h1 class="text-center mb-4">è¨ºæ–­ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ã‚¿ãƒ¼</h1>
        <div class="alert alert-info">
            <strong>æ³¨æ„:</strong> ã“ã‚Œã‚‰ã®ã‚·ãƒŠãƒªã‚ªã¯é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®ã¿å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯çµ¶å¯¾ã«å®Ÿè¡Œã—ãªã„ã§ãã ã•ã„ã€‚
        </div>
    </div>

    <!-- ä¾‹å¤–ãƒãƒ¼ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">âš¡ ä¾‹å¤–ãƒãƒ¼ã‚¹ãƒˆ</h5>
            </div>
            <div class="card-body">
                <p class="card-text">æŒ‡å®šã—ãŸç§’æ•°ã®é–“ã€1ç§’ã‚ãŸã‚ŠæŒ‡å®šå›æ•°ã®ä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ç¶šã‘ã¾ã™ã€‚</p>
                <div class="input-group mb-2">
                    <span class="input-group-text">ç§’æ•°</span>
                    <input type="number" class="form-control" id="exceptionburst-seconds" value="5" min="1" max="1800">
                </div>
                <div class="input-group mb-2">
                    <span class="input-group-text">1ç§’ã‚ãŸã‚Š</span>
                    <input type="number" class="form-control" id="exceptionburst-rate" value="10" min="1" max="1000">
                    <span class="input-group-text">å›</span>
                </div>
                <button class="btn btn-danger" onclick="executeExceptionBurst()">
                    ä¾‹å¤–ãƒãƒ¼ã‚¹ãƒˆå®Ÿè¡Œ
                </button>
                <div id="exceptionburst-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- ç¢ºç‡çš„ä¾‹å¤–ãƒ­ãƒ¼ãƒ‰ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">ğŸ¯ ç¢ºç‡çš„ä¾‹å¤–ãƒ­ãƒ¼ãƒ‰</h5>
            </div>
            <div class="card-body">
                <p class="card-text">Nç§’é–“ã€ç§’é–“Må›ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‘¼ã³å‡ºã—ã‚’å®Ÿè¡Œã—ã€ãã®ã†ã¡X%ã§ä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ã¾ã™ã€‚</p>
                <div class="input-group mb-2">
                    <span class="input-group-text">ç¶™ç¶šæ™‚é–“</span>
                    <input type="number" class="form-control" id="probabilistic-duration" value="10" min="1" max="1800">
                    <span class="input-group-text">ç§’</span>
                </div>
                <div class="input-group mb-2">
                    <span class="input-group-text">1ç§’ã‚ãŸã‚Š</span>
                    <input type="number" class="form-control" id="probabilistic-rate" value="5" min="1" max="1000">
                    <span class="input-group-text">ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</span>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">ä¾‹å¤–ç‡</span>
                    <input type="number" class="form-control" id="probabilistic-error" value="20" min="0" max="100">
                    <span class="input-group-text">%</span>
                </div>
                <button class="btn btn-primary" onclick="executeProbabilisticLoad()">
                    ç¢ºç‡çš„ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
                </button>
                <div id="probabilistic-result" class="mt-3"></div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">ğŸ”’ ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯</h5>
            </div>
            <div class="card-body">
                <p class="card-text">ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯çŠ¶æ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒäº’ã„ã«ãƒ­ãƒƒã‚¯ã‚’å¾…æ©Ÿã™ã‚‹çŠ¶æ³ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
                <button class="btn btn-danger" onclick="executeScenario('/api/DiagScenario/deadlock', 'deadlock-result')">
                    ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯å®Ÿè¡Œ
                </button>
                <div id="deadlock-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ãƒ¢ãƒªã‚¹ãƒ‘ã‚¤ã‚¯ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">ğŸ“ˆ ãƒ¡ãƒ¢ãƒªã‚¹ãƒ‘ã‚¤ã‚¯</h5>
            </div>
            <div class="card-body">
                <p class="card-text">æŒ‡å®šã—ãŸç§’æ•°é–“ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’æ€¥æ¿€ã«å¢—åŠ ã•ã›ã¾ã™ã€‚</p>
                <div class="input-group mb-2">
                    <input type="number" class="form-control" id="memspike-seconds" placeholder="ç§’æ•°" value="10" min="1" max="1800">
                    <span class="input-group-text">ç§’</span>
                </div>
                <button class="btn btn-warning" onclick="executeMemSpike()">
                    ãƒ¡ãƒ¢ãƒªã‚¹ãƒ‘ã‚¤ã‚¯å®Ÿè¡Œ
                </button>
                <div id="memspike-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">ğŸ”„ ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯</h5>
            </div>
            <div class="card-body">
                <p class="card-text">æŒ‡å®šã—ãŸã‚µã‚¤ã‚ºåˆ†ã®ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚</p>
                <div class="input-group mb-2">
                    <input type="number" class="form-control" id="memleak-kb" placeholder="KBæ•°" value="1024" min="1" max="10240">
                    <span class="input-group-text">KB</span>
                </div>
                <button class="btn btn-warning" onclick="executeMemLeak()">
                    ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å®Ÿè¡Œ
                </button>
                <div id="memleak-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- ä¾‹å¤–ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">ğŸ’¥ ä¾‹å¤–ç™ºç”Ÿ</h5>
            </div>
            <div class="card-body">
                <p class="card-text">æ„å›³çš„ã«ä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ã¦ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
                <button class="btn btn-danger" onclick="executeScenario('/api/DiagScenario/exception', 'exception-result')">
                    ä¾‹å¤–å®Ÿè¡Œ
                </button>
                <div id="exception-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- é«˜CPUä½¿ç”¨ç‡ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">ğŸ”¥ é«˜CPUä½¿ç”¨ç‡</h5>
            </div>
            <div class="card-body">
                <p class="card-text">æŒ‡å®šã—ãŸãƒŸãƒªç§’é–“CPUä½¿ç”¨ç‡ã‚’100%è¿‘ãã¾ã§ä¸Šã’ã¾ã™ã€‚</p>
                <div class="input-group mb-2">
                    <input type="number" class="form-control" id="highcpu-ms" placeholder="ãƒŸãƒªç§’" value="5000" min="100" max="30000">
                    <span class="input-group-text">ms</span>
                </div>
                <button class="btn btn-info" onclick="executeHighCpu()">
                    é«˜CPUå®Ÿè¡Œ
                </button>
                <div id="highcpu-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Task.Wait()ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">â³ Task.Wait()</h5>
            </div>
            <div class="card-body">
                <p class="card-text">Task.Wait()ã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«ã®é£¢é¤“çŠ¶æ…‹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚</p>
                <button class="btn btn-secondary" onclick="executeScenario('/api/DiagScenario/taskwait', 'taskwait-result')">
                    Task.Wait()å®Ÿè¡Œ
                </button>
                <div id="taskwait-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Task Sleep Wait ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">ğŸ˜´ Task Sleep Wait</h5>
            </div>
            <div class="card-body">
                <p class="card-text">Thread.Sleep()ã‚’ä½¿ç”¨ã—ã¦ã‚¿ã‚¹ã‚¯ã®å®Œäº†ã‚’å¾…æ©Ÿã™ã‚‹éåŠ¹ç‡çš„ãªæ–¹æ³•ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚</p>
                <button class="btn btn-secondary" onclick="executeScenario('/api/DiagScenario/tasksleepwait', 'tasksleepwait-result')">
                    Task Sleep Waitå®Ÿè¡Œ
                </button>
                <div id="tasksleepwait-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Task Async Wait ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">âœ… Task Async Wait (æ­£å¸¸)</h5>
            </div>
            <div class="card-body">
                <p class="card-text">awaitã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ãŸæ­£ã—ã„éåŒæœŸå‡¦ç†ã®ä¾‹ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>
                <button class="btn btn-success" onclick="executeScenario('/api/DiagScenario/taskasyncwait', 'taskasyncwait-result')">
                    Task Async Waitå®Ÿè¡Œ
                </button>
                <div id="taskasyncwait-result" class="mt-3"></div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // åŸºæœ¬çš„ãªã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œé–¢æ•°
        async function executeScenario(url, resultElementId) {
            const resultElement = document.getElementById(resultElementId);
            resultElement.innerHTML = '<div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div> å®Ÿè¡Œä¸­...';
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const result = await response.text();
                    resultElement.innerHTML = `<div class="alert alert-success">âœ… ${result}</div>`;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                resultElement.innerHTML = `<div class="alert alert-danger">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        // ãƒ¡ãƒ¢ãƒªã‚¹ãƒ‘ã‚¤ã‚¯å®Ÿè¡Œ
        async function executeMemSpike() {
            const seconds = document.getElementById('memspike-seconds').value;
            if (!seconds || seconds < 1 || seconds > 1800) {
                alert('æœ‰åŠ¹ãªç§’æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-1800)');
                return;
            }
            await executeScenario(`/api/DiagScenario/memspike/${seconds}`, 'memspike-result');
        }

        // ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å®Ÿè¡Œ
        async function executeMemLeak() {
            const kb = document.getElementById('memleak-kb').value;
            if (!kb || kb < 1) {
                alert('æœ‰åŠ¹ãªKBæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-10240)');
                return;
            }
            await executeScenario(`/api/DiagScenario/memleak/${kb}`, 'memleak-result');
        }

        // ä¾‹å¤–ãƒãƒ¼ã‚¹ãƒˆå®Ÿè¡Œ
        async function executeExceptionBurst() {
            const seconds = parseInt(document.getElementById('exceptionburst-seconds').value, 10);
            const rate = parseInt(document.getElementById('exceptionburst-rate').value, 10);

            if (!seconds || seconds < 1 || seconds > 1800) {
                alert('æœ‰åŠ¹ãªç§’æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-1800)');
                return;
            }

            if (!rate || rate < 1 || rate > 1000) {
                alert('1ç§’ã‚ãŸã‚Šã®å›æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-1000)');
                return;
            }

            await executeScenario(`/api/DiagScenario/exceptionburst/${seconds}/${rate}`, 'exceptionburst-result');
        }

        // ç¢ºç‡çš„ä¾‹å¤–ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
        async function executeProbabilisticLoad() {
            const duration = parseInt(document.getElementById('probabilistic-duration').value, 10);
            const rate = parseInt(document.getElementById('probabilistic-rate').value, 10);
            const errorRate = parseInt(document.getElementById('probabilistic-error').value, 10);

            if (!duration || duration < 1 || duration > 1800) {
                alert('ç¶™ç¶šæ™‚é–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-1800ç§’)');
                return;
            }

            if (!rate || rate < 1 || rate > 1000) {
                alert('1ç§’ã‚ãŸã‚Šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-1000)');
                return;
            }

            if (Number.isNaN(errorRate) || errorRate < 0 || errorRate > 100) {
                alert('ä¾‹å¤–ç‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (0-100%)');
                return;
            }

            await executeScenario(`/api/DiagScenario/probabilisticload/${duration}/${rate}/${errorRate}`, 'probabilistic-result');
        }

        // é«˜CPUå®Ÿè¡Œ
        async function executeHighCpu() {
            const ms = document.getElementById('highcpu-ms').value;
            if (!ms || ms < 100) {
                alert('æœ‰åŠ¹ãªãƒŸãƒªç§’æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (100-30000)');
                return;
            }
            await executeScenario(`/api/DiagScenario/highcpu/${ms}`, 'highcpu-result');
        }
    </script>
}
