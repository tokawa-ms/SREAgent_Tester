@using Microsoft.Extensions.Localization
@inject IHtmlLocalizer<DiagnosticScenarios.Resources.SharedResources> Localizer

@{
    ViewData["Title"] = Localizer["Home.Title"];
}

<div class="row">
    <div class="col-md-12">
        <h1 class="text-center mb-4">@Localizer["Home.PageTitle"]</h1>
        <div class="alert alert-info">
            <strong>@Localizer["Common.Warning"]:</strong> @Localizer["Home.WarningMessage"]
        </div>
    </div>

    <!-- ä¾‹å¤–ãƒãƒ¼ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">âš¡ @Localizer["ExceptionBurst.Title"]</h5>
            </div>
            <div class="card-body">
                <p class="card-text">@Localizer["ExceptionBurst.Description"]</p>
                <div class="input-group mb-2">
                    <span class="input-group-text">@Localizer["ExceptionBurst.Seconds"]</span>
                    <input type="number" class="form-control" id="exceptionburst-seconds" value="5" min="1" max="1800">
                </div>
                <div class="input-group mb-2">
                    <span class="input-group-text">@Localizer["ExceptionBurst.PerSecond"]</span>
                    <input type="number" class="form-control" id="exceptionburst-rate" value="10" min="1" max="1000">
                    <span class="input-group-text">@Localizer["ExceptionBurst.Times"]</span>
                </div>
                <button class="btn btn-danger" onclick="executeExceptionBurst()">
                    @Localizer["ExceptionBurst.Execute"]
                </button>
                <div id="exceptionburst-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- ç¢ºç‡çš„ä¾‹å¤–ãƒ­ãƒ¼ãƒ‰ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">ğŸ¯ @Localizer["ProbabilisticLoad.Title"]</h5>
            </div>
            <div class="card-body">
                <p class="card-text">@Localizer["ProbabilisticLoad.Description"]</p>
                <div class="input-group mb-2">
                    <span class="input-group-text">@Localizer["ProbabilisticLoad.Duration"]</span>
                    <input type="number" class="form-control" id="probabilistic-duration" value="10" min="1" max="1800">
                    <span class="input-group-text">@Localizer["ExceptionBurst.Seconds"]</span>
                </div>
                <div class="input-group mb-2">
                    <span class="input-group-text">@Localizer["ProbabilisticLoad.RequestsPerSecond"]</span>
                    <input type="number" class="form-control" id="probabilistic-rate" value="5" min="1" max="1000">
                    <span class="input-group-text">@Localizer["ProbabilisticLoad.Requests"]</span>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">@Localizer["ProbabilisticLoad.ErrorRate"]</span>
                    <input type="number" class="form-control" id="probabilistic-error" value="20" min="0" max="100">
                    <span class="input-group-text">%</span>
                </div>
                <button class="btn btn-primary" onclick="executeProbabilisticLoad()">
                    @Localizer["ProbabilisticLoad.Execute"]
                </button>
                <div id="probabilistic-result" class="mt-3"></div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">ğŸ”’ @Localizer["Deadlock.Title"]</h5>
            </div>
            <div class="card-body">
                <p class="card-text">@Localizer["Deadlock.Description"]</p>
                <button class="btn btn-danger" onclick="executeScenario('/api/DiagScenario/deadlock', 'deadlock-result')">
                    @Localizer["Deadlock.Execute"]
                </button>
                <div id="deadlock-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ãƒ¢ãƒªã‚¹ãƒ‘ã‚¤ã‚¯ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">ğŸ“ˆ @Localizer["MemorySpike.Title"]</h5>
            </div>
            <div class="card-body">
                <p class="card-text">@Localizer["MemorySpike.Description"]</p>
                <div class="input-group mb-2">
                    <input type="number" class="form-control" id="memspike-seconds" placeholder="@Localizer["ExceptionBurst.Seconds"]" value="10" min="1" max="1800">
                    <span class="input-group-text">@Localizer["ExceptionBurst.Seconds"]</span>
                </div>
                <button class="btn btn-warning" onclick="executeMemSpike()">
                    @Localizer["MemorySpike.Execute"]
                </button>
                <div id="memspike-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">ğŸ”„ @Localizer["MemoryLeak.Title"]</h5>
            </div>
            <div class="card-body">
                <p class="card-text">@Localizer["MemoryLeak.Description"]</p>
                <div class="input-group mb-2">
                    <input type="number" class="form-control" id="memleak-kb" placeholder="@Localizer["MemoryLeak.KB"]" value="1024" min="1" max="10240">
                    <span class="input-group-text">@Localizer["MemoryLeak.KB"]</span>
                </div>
                <button class="btn btn-warning" onclick="executeMemLeak()">
                    @Localizer["MemoryLeak.Execute"]
                </button>
                <div id="memleak-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- ä¾‹å¤–ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">ğŸ’¥ @Localizer["Exception.Title"]</h5>
            </div>
            <div class="card-body">
                <p class="card-text">@Localizer["Exception.Description"]</p>
                <button class="btn btn-danger" onclick="executeScenario('/api/DiagScenario/exception', 'exception-result')">
                    @Localizer["Exception.Execute"]
                </button>
                <div id="exception-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- é«˜CPUä½¿ç”¨ç‡ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">ğŸ”¥ @Localizer["HighCpu.Title"]</h5>
            </div>
            <div class="card-body">
                <p class="card-text">@Localizer["HighCpu.Description"]</p>
                <div class="input-group mb-2">
                    <input type="number" class="form-control" id="highcpu-ms" placeholder="@Localizer["HighCpu.Milliseconds"]" value="5000" min="100" max="30000">
                    <span class="input-group-text">ms</span>
                </div>
                <button class="btn btn-info" onclick="executeHighCpu()">
                    @Localizer["HighCpu.Execute"]
                </button>
                <div id="highcpu-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Task.Wait()ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">â³ @Localizer["TaskWait.Title"]</h5>
            </div>
            <div class="card-body">
                <p class="card-text">@Localizer["TaskWait.Description"]</p>
                <button class="btn btn-secondary" onclick="executeScenario('/api/DiagScenario/taskwait', 'taskwait-result')">
                    @Localizer["TaskWait.Execute"]
                </button>
                <div id="taskwait-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Task Sleep Wait ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">ğŸ˜´ @Localizer["TaskSleepWait.Title"]</h5>
            </div>
            <div class="card-body">
                <p class="card-text">@Localizer["TaskSleepWait.Description"]</p>
                <button class="btn btn-secondary" onclick="executeScenario('/api/DiagScenario/tasksleepwait', 'tasksleepwait-result')">
                    @Localizer["TaskSleepWait.Execute"]
                </button>
                <div id="tasksleepwait-result" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Task Async Wait ã‚·ãƒŠãƒªã‚ª -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">âœ… @Localizer["TaskAsyncWait.Title"]</h5>
            </div>
            <div class="card-body">
                <p class="card-text">@Localizer["TaskAsyncWait.Description"]</p>
                <button class="btn btn-success" onclick="executeScenario('/api/DiagScenario/taskasyncwait', 'taskasyncwait-result')">
                    @Localizer["TaskAsyncWait.Execute"]
                </button>
                <div id="taskasyncwait-result" class="mt-3"></div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // åŸºæœ¬çš„ãªã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œé–¢æ•°
        async function executeScenario(url, resultElementId) {
            const resultElement = document.getElementById(resultElementId);
            resultElement.innerHTML = '<div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div> å®Ÿè¡Œä¸­...';
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const result = await response.text();
                    resultElement.innerHTML = `<div class="alert alert-success">âœ… ${result}</div>`;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                resultElement.innerHTML = `<div class="alert alert-danger">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        // ãƒ¡ãƒ¢ãƒªã‚¹ãƒ‘ã‚¤ã‚¯å®Ÿè¡Œ
        async function executeMemSpike() {
            const seconds = document.getElementById('memspike-seconds').value;
            if (!seconds || seconds < 1 || seconds > 1800) {
                alert('æœ‰åŠ¹ãªç§’æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-1800)');
                return;
            }
            await executeScenario(`/api/DiagScenario/memspike/${seconds}`, 'memspike-result');
        }

        // ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å®Ÿè¡Œ
        async function executeMemLeak() {
            const kb = document.getElementById('memleak-kb').value;
            if (!kb || kb < 1) {
                alert('æœ‰åŠ¹ãªKBæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-10240)');
                return;
            }
            await executeScenario(`/api/DiagScenario/memleak/${kb}`, 'memleak-result');
        }

        // ä¾‹å¤–ãƒãƒ¼ã‚¹ãƒˆå®Ÿè¡Œ
        async function executeExceptionBurst() {
            const seconds = parseInt(document.getElementById('exceptionburst-seconds').value, 10);
            const rate = parseInt(document.getElementById('exceptionburst-rate').value, 10);

            if (!seconds || seconds < 1 || seconds > 1800) {
                alert('æœ‰åŠ¹ãªç§’æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-1800)');
                return;
            }

            if (!rate || rate < 1 || rate > 1000) {
                alert('1ç§’ã‚ãŸã‚Šã®å›æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-1000)');
                return;
            }

            await executeScenario(`/api/DiagScenario/exceptionburst/${seconds}/${rate}`, 'exceptionburst-result');
        }

        // ç¢ºç‡çš„ä¾‹å¤–ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
        async function executeProbabilisticLoad() {
            const duration = parseInt(document.getElementById('probabilistic-duration').value, 10);
            const rate = parseInt(document.getElementById('probabilistic-rate').value, 10);
            const errorRate = parseInt(document.getElementById('probabilistic-error').value, 10);

            if (!duration || duration < 1 || duration > 1800) {
                alert('ç¶™ç¶šæ™‚é–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-1800ç§’)');
                return;
            }

            if (!rate || rate < 1 || rate > 1000) {
                alert('1ç§’ã‚ãŸã‚Šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-1000)');
                return;
            }

            if (Number.isNaN(errorRate) || errorRate < 0 || errorRate > 100) {
                alert('ä¾‹å¤–ç‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (0-100%)');
                return;
            }

            await executeScenario(`/api/DiagScenario/probabilisticload/${duration}/${rate}/${errorRate}`, 'probabilistic-result');
        }

        // é«˜CPUå®Ÿè¡Œ
        async function executeHighCpu() {
            const ms = document.getElementById('highcpu-ms').value;
            if (!ms || ms < 100) {
                alert('æœ‰åŠ¹ãªãƒŸãƒªç§’æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (100-30000)');
                return;
            }
            await executeScenario(`/api/DiagScenario/highcpu/${ms}`, 'highcpu-result');
        }
    </script>
}
